<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Certificados</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Times New Roman', Times, serif; 
            background-color: #f3f4f6;
        }
        
        /* Contenedor en pantalla */
        .certificate-container {
            background: white;
            padding: 3rem; /* Margen interno en pantalla */
            border-radius: 5px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            max-width: 21.59cm; /* Ancho carta */
            margin: 0 auto;
            min-height: 27.94cm; /* Alto carta */
            position: relative;
        }

        /* CONFIGURACIÓN DE IMPRESIÓN (ESTRICTA 1 PLANA) */
        @media print {
            @page {
                size: letter;
                margin: 1.5cm; /* Margen físico de la hoja */
            }
            body {
                background-color: white;
                margin: 0;
                padding: 0;
                -webkit-print-color-adjust: exact;
            }
            .no-print {
                display: none !important;
            }
            .certificate-container {
                width: 100%;
                max-width: 100%;
                margin: 0;
                padding: 0; 
                box-shadow: none;
                border: none;
            }
            /* Evitar cortes de página dentro de elementos */
            div, p, img {
                break-inside: avoid;
            }
        }
    </style>
</head>
<body class="p-6">

    <header class="max-w-2xl mx-auto text-center mb-6 no-print font-sans">
        <h1 class="text-3xl font-bold text-blue-900 mb-1">
            <i class="fa-solid fa-print mr-2"></i>Generador de Certificados
        </h1>
        <p class="text-blue-600 text-sm">Escuela Agrícola Sagrados Corazones</p>
    </header>

    <main class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-6 font-sans">
        
        <div class="lg:col-span-4 no-print space-y-4">
            
            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                <label class="block text-xs font-bold text-blue-800 uppercase mb-1">Año del Certificado</label>
                <select id="year-select" class="w-full p-2 border border-blue-300 rounded text-sm font-bold text-blue-900">
                    <option value="2025" selected>2025 (Año Actual)</option>
                    <option value="2026">2026 (Promoción Automática)</option>
                </select>
            </div>

            <div class="bg-white p-5 rounded-lg shadow border border-gray-200">
                <h2 class="text-sm font-bold text-gray-700 mb-3 border-b pb-2">Datos del Estudiante</h2>

                <div class="space-y-3">
                    <div>
                        <label class="block text-xs font-semibold text-gray-600 mb-1">Curso</label>
                        <select id="course-select" class="w-full p-2 border rounded text-sm bg-gray-50">
                            <option value="">Cargando cursos...</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-xs font-semibold text-gray-600 mb-1">Alumno</label>
                        <select id="student-select" disabled class="w-full p-2 border rounded text-sm bg-gray-100">
                            <option value="">Seleccione un curso primero</option>
                        </select>
                    </div>

                    <div id="action-buttons" class="hidden pt-2 grid grid-cols-1 gap-2">
                        <button onclick="generateCertificate('regular')" class="w-full py-2 bg-blue-600 text-white rounded text-sm font-bold hover:bg-blue-700">
                            Generar Alumno Regular
                        </button>
                        <button onclick="generateCertificate('matricula')" class="w-full py-2 bg-white text-blue-600 border border-blue-600 rounded text-sm font-bold hover:bg-blue-50">
                            Generar Matrícula
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="text-center">
                <a href="portal_secretaria.html" class="text-xs text-gray-500 hover:text-blue-600 font-bold"><i class="fa-solid fa-arrow-left"></i> Volver al Portal</a>
            </div>
        </div>

        <div class="lg:col-span-8">
            <div id="preview-container" class="hidden">
                <div class="bg-gray-800 text-white p-2 rounded-t-lg flex justify-between items-center no-print">
                    <span class="text-xs font-bold px-2">Vista Previa (Tamaño Carta)</span>
                    <button onclick="window.print()" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs font-bold transition">
                        <i class="fa-solid fa-print mr-1"></i> IMPRIMIR
                    </button>
                </div>

                <div id="certificate-content"></div>
            </div>

            <div id="initial-placeholder" class="h-96 flex flex-col items-center justify-center bg-white rounded-lg border-2 border-dashed border-gray-300 text-center no-print">
                <i class="fa-solid fa-file-pdf text-4xl text-gray-300 mb-3"></i>
                <p class="text-gray-400 text-sm">Selecciona un alumno para<br>generar el documento.</p>
            </div>
        </div>

    </main>

    <script>
        // BASE DE DATOS COMPLETA (2025)
        const RAW_DATA = [
            ['1A', '23376817-0', 'EMILYA', 'ANTONIA', 'ALBURQUENQUE', 'DEL GRECO'],
            ['1A', '22922460-3', 'BENJAMÍN', 'NICOLÁS', 'ANABALÓN', 'BELTRÁN'],
            ['1A', '23355953-9', 'HADEEY', 'ALEJANDRA', 'CONTRERAS', 'SALGADO'],
            ['1A', '23560082-k', 'AGUSTÍN', 'ALEXIS', 'FERRADA', 'ALBORNOZ'],
            ['1A', '23644472-4', 'FERNANDA', 'MAGDALENA', 'IBÁÑEZ', 'GONZÁLEZ'],
            ['1A', '23389072-3', 'ALEXANDRA', 'DANAE', 'LAGOS', 'LASTRA'],
            ['1A', '23498596-5', 'LUCIANO', 'ANTONIO', 'LÓPEZ', 'LÓPEZ'],
            ['1A', '23396870-6', 'ANTONELLA', 'BELÉN', 'MALDONADO', 'FLORES'],
            ['1A', '22793858-7', 'IGNACIO', 'ANTONIO', 'MARIN', 'MARÍN'],
            ['1A', '23548214-2', 'VALESKA', 'BELÉN', 'MONTECINO', 'DÍAZ'],
            ['1A', '23366642-4', 'LUIS', 'GABRIEL', 'MUÑOZ', 'CONTRERAS'],
            ['1A', '23622121-0', 'ROGER', 'JOEL', 'MUÑOZ', 'LUNA'],
            ['1A', '23329866-2', 'KARLA', 'PAZ', 'NAVARRO', 'VILLANUEVA'],
            ['1A', '23388136-8', 'SEBASTIÁN', 'ANDRÉS', 'ORELLANA', 'ARRIAGADA'],
            ['1A', '23640108-1', 'FELIPE', 'ALONSO', 'QUEZADA', 'NARANJO'],
            ['1A', '23529637-3', 'FERNANDA', 'FLORENCIA', 'QUINTEROS', 'VERGARA'],
            ['1A', '23534317-7', 'DUVAN', 'EMILIO', 'RAMÍREZ', 'VILLALOBOS'],
            ['1A', '23679554-3', 'MARÍA', 'JOSÉ', 'SANTANDER', 'LÓPEZ'],
            ['1A', '23631475-8', 'JEANFRANCO', 'PATRICK', 'TAPIA', 'CASTILLA'],
            ['1A', '23007625-1', 'FRANCHESCA', 'POULETTE', 'URBINA', 'CÁCERES'],
            ['1A', '23584521-0', 'AMANDA', 'ISABEL', 'VÁSQUEZ', 'ZALDUENDO'],
            ['1A', '23404221-1', 'DAMIÁN', 'ANDRÉS', 'ZABALAGA', 'COFRÉ'],
            ['1A', '23461777-k', 'LUKAS', 'ALFONSO', 'BAEZ', 'DONOSO'],
            ['1A', '23032545-6', 'GONZALO', 'IGNACIO', 'MESA', 'DÍAZ'],
            ['1B', '23367234-3', 'NOEMÍ', 'DE JESÚS', 'ARAVENA', 'ZÚÑIGA'],
            ['1B', '22826488-1', 'CRISTÓBAL', 'ANTONIO', 'ASTUDILLO', 'CAMPOS'],
            ['1B', '23251746-8', 'BRUNO', 'FERNANDO', 'ASTUDILLO', 'VÁSQUEZ'],
            ['1B', '23545428-9', 'CATALINA', 'ANDREA', 'CUMINAO', 'VIDAL'],
            ['1B', '23224652-9', 'MIGUEL', 'ALBERTO', 'DÍAZ', 'MALUENDA'],
            ['1B', '23337375-3', 'DIDIER', 'EZEQUIEL', 'KILTAN', 'GONZÁLEZ'],
            ['1B', '23355954-7', 'MARCO', 'EMILIO', 'LÓPEZ', 'ACUÑA'],
            ['1B', '23153879-8', 'EYDAN', 'DAMIÁN', 'LÓPEZ', 'NOVOA'],
            ['1B', '20760552-2', 'FABIÁN', 'FELIPE', 'MÉNDEZ', 'SUAZO'],
            ['1B', '23391772-9', 'MATEO', 'ANTONIO', 'MOYA', 'REYES'],
            ['1B', '23432193-5', 'VALENTINA', 'ABIGAIL', 'OSES', 'CAMPOS'],
            ['1B', '23190411-5', 'ANTONELLA', 'FRANCISCA', 'PALMA', 'ORELLANA'],
            ['1B', '23605196-K', 'MONSERRAT', 'ALAMIRA', 'PEREIRA', 'ORELLANA'],
            ['1B', '23415461-3', 'ZADKA', 'ALEJANDRA', 'PÉREZ', 'ORMAZÁBAL'],
            ['1B', '23290841-6', 'FLORENCIA', 'TRINIDAD', 'ROJAS', 'GONZÁLEZ'],
            ['1B', '23264828-7', 'EDUARDO', 'JAVIER', 'ROJAS', 'LEIVA'],
            ['1B', '22763630-0', 'SCARLET', 'NICOLE', 'VÁSQUEZ', 'AGUILERA'],
            ['1B', '23616701-1', 'BRAYAN', 'DAMIÁN', 'YÁÑEZ', 'GONZÁLEZ'],
            ['1B', '23555453-4', 'MARTINA', 'SAYEN', 'VARGAS', 'MORAGA'],
            ['1B', '23301500-8', 'PEDRO', 'JOSÉ', 'SALAZAR', 'SALAS'],
            ['1B', '23296637-8', 'FLORENCIA', 'ANTONIA', 'VERA', 'BRAVO'],
            ['1B', '23479449-3', 'CONSTANZA', 'TRINIDAD', 'PÉREZ', 'QUEVEDO'],
            ['1B', '23112966-9', 'BENJAMÍN', 'ALONSO', 'RIQUELME', 'SANTOS'],
            ['2A', '23006149-1', 'TRINIDAD', 'BELÉN', 'AHUMADA', 'ROJAS'],
            ['2A', '23090163-5', 'FERNANDA', 'ELENA', 'ESPINOSA', 'TORRES'],
            ['2A', '23236242-1', 'BRAYAN', 'JESÚS', 'ESPINOZA', 'PEÑALILLO'],
            ['2A', '23121508-5', 'EMILIA', 'CATALINA', 'GONZÁLEZ', 'SALAZAR'],
            ['2A', '23132468-2', 'LEÓN', 'IGNACIO', 'MEDEL', 'OJEDA'],
            ['2A', '22617512-1', 'ALFONSO', 'TOMÁS', 'MORALES', 'REIMÁN'],
            ['2A', '23054557-K', 'MAXIMILIANO', 'EDUARDO', 'PEREIRA', 'HORMAZÁBAL'],
            ['2A', '23029359-7', 'JORDÁN', 'AMARO', 'PINTO', 'TOBAR'],
            ['2A', '23086976-6', 'KEVIN', 'ANDRÉS', 'RECABAL', 'YÁÑEZ'],
            ['2A', '23284002-1', 'MATÍAS', 'EDUARDO', 'RIQUELME', 'CASTILLO'],
            ['2A', '23141589-0', 'CONSTANZA', 'VICTORIA', 'RIVERA', 'ABARZA'],
            ['2A', '23294557-5', 'TEIVA', 'SCARLETT', 'SANTIS', 'CASSEUS'],
            ['2A', '22912548-6', 'KATHERINNE', 'ALEXIA', 'SOBARZO', 'YÉVENES'],
            ['2A', '23209204-1', 'ANTONELLA', 'INES', 'TOLEDO', 'ALBORNOZ'],
            ['2A', '23115030-7', 'ANTONIA', 'EDITH', 'VENEGAS', 'ARRIAGADA'],
            ['2A', '23146366-6', 'JOAN', 'MANUEL', 'VIELMA', 'ZABALAGA'],
            ['2A', '23255825-3', 'ANGEL', 'BLAS', 'MEZA', 'COLIMÁN'],
            ['2A', '23164383-4', 'FLORENCIA', 'ALEJANDRA', 'SAAVEDRA', 'BRAVO'],
            ['2B', '22927087-7', 'ALEX', 'FABIÁN', 'ARAYA', 'DOMÍNGUEZ'],
            ['2B', '23099931-7', 'ALEX', 'JOHAN', 'BRAVO', 'MENARES'],
            ['2B', '23200990-K', 'BENJAMÍN', 'IGNACIO', 'CARRASCO', 'LEIVA'],
            ['2B', '23086622-8', 'CONSTANZA', 'PRISILA', 'CARVAJAL', 'URRUTIA'],
            ['2B', '23194660-8', 'DIEGO', 'BENJAMÍN', 'ENCINA', 'PIZARRO'],
            ['2B', '23229539-2', 'ALEJANDRO', 'ANTONIO', 'FAÚNDEZ', 'NORAMBUENA'],
            ['2B', '22827535-2', 'EMILIO', 'SCOTT', 'JARAMILLO', 'VILLAR'],
            ['2B', '23321258-K', 'MARTÍN', 'ALONSO', 'LÓPEZ', 'VILLAR'],
            ['2B', '23285276-3', 'ALEXANDRA', 'JAVIERA', 'MIRANDA', 'MUÑOZ'],
            ['2B', '22459961-7', 'HÉCTOR', 'ANTONIO', 'MUÑOZ', 'TRONCOSO'],
            ['2B', '23097156-0', 'ALONSO', 'IGNACIO', 'OLIVARES', 'VALENZUELA'],
            ['2B', '22804086-k', 'ANTONELLA', 'DANAE', 'OLIVARES', 'VALENZUELA'],
            ['2B', '22876195-8', 'MATÍAS', 'LEANDRO', 'ORELLANA', 'GARRIDO'],
            ['2B', '23113000-4', 'MILLARAY', 'ANGÉLICA', 'PUNOY', 'MEDEL'],
            ['2B', '23118361-2', 'CRISTÓBAL', 'PATRICIO', 'QUIÑENAO', 'MUÑOZ'],
            ['2B', '23244598-K', 'DALIA', 'CONSTANZA', 'RIQUELME', 'COLOMA'],
            ['2B', '23304433-4', 'VICENTE', 'MOISÉS', 'SALGADO', 'ROJAS'],
            ['2B', '22922664-9', 'VICENTE', 'ESTEBAN', 'SANDOVAL', 'CERPA'],
            ['2B', '23230279-8', 'CHRISTOPHER', '', 'SOTO', 'NARANJO'],
            ['2B', '22907717-1', 'MARTÍN', '', 'VEKARIC', 'VERDEJO'],
            ['3A', '22717035-2', 'MARTINA', 'ALEJANDRA', 'ALCÁNTAR', 'GARCÍA'],
            ['3A', '22202028-K', 'ARIEL', 'LEON', 'BAHAMONDE', 'MUÑOZ'],
            ['3A', '22932851-4', 'CRISTOPHER', 'JESÚS', 'CAMPOS', 'MUÑOZ'],
            ['3A', '22587064-0', 'VICENTE', 'GASPAR', 'CANCINO', 'ORÓSTICA'],
            ['3A', '22935345-4', 'CAMILA', 'ANDREA', 'CARRASCO', 'GONZÁLEZ'],
            ['3A', '22852052-7', 'ANTONIO', 'ANDRÉS', 'COFRÉ', 'CASTILLO'],
            ['3A', '22542992-8', 'BELÉN', 'ALEJANDRA', 'CONTRERAS', 'VENEGAS'],
            ['3A', '22897408-0', 'FELIPE', 'ESTEBAN', 'GALDAMES', 'VERGARA'],
            ['3A', '22152106-4', 'SANTIAGO', 'HUMBERTO', 'GARCÍA', 'GONZÁLEZ'],
            ['3A', '22820588-5', 'FRANCISCA', 'IGNACIA', 'GONZÁLEZ', 'AMIGO'],
            ['3A', '22565627-4', 'JOAQUÍN', 'ALONSO', 'GONZÁLEZ', 'SALAZAR'],
            ['3A', '22808692-4', 'ANGEL', 'MARTÍN', 'GUTIÉRREZ', 'GUTIÉRREZ'],
            ['3A', '22970003-0', 'AARON', 'ALEJANDRO', 'MARTÍNEZ', 'LIZANA'],
            ['3A', '22482618-4', 'BENJAMÍN', 'INTI', 'MEZA', 'CARRASCO'],
            ['3A', '22858572-6', 'CATALINA', 'ANDREA', 'MIÑO', 'GONZALEZ'],
            ['3A', '22932822-0', 'RENATO', 'IGNACIO', 'MORAGA', 'PACHECO'],
            ['3A', '22839912-4', 'MANUEL', 'IGNACIO', 'PÉREZ', 'CORÓN'],
            ['3A', '100710921-7', 'JAKSON', 'FERGIE', 'SAMANIEGO', 'CORTEZ'],
            ['3A', '22889391-9', 'SOFÍA', 'ANTONIA', 'SEPÚLVEDA', 'SALAZAR'],
            ['3A', '22709426-5', 'GABRIEL', 'ANTONIO', 'TAPIA', 'ACUÑA'],
            ['3A', '23022549-4', 'CRISTÓBAL', 'ANTONIO', 'VEGA', 'VIVANCO'],
            ['3A', '22903476-6', 'DANIELA', 'ELIZABETH', 'VERA', 'NAVARRETE'],
            ['3A', '22792420-9', 'KARINA', 'ANGELINA', 'VILLALOBOS', 'ARAVENA'],
            ['3A', '22733377-4', 'SAMIR', 'LUCIAN', 'VILLALOBOS', 'VILLALOBOS'],
            ['3A', '22644932-9', 'VICENTE', 'ALEJANDRO', 'HERNÁNDEZ', 'SEPÚLVEDA'],
            ['3A', '100793606-7', 'FLORVELIS', 'DE LOS ANGELES', 'TORREALBA', 'MOYA'],
            ['3A', '23038091-0', 'CONSUELO', 'ANTONIA', 'CARO', 'URRUTIA'],
            ['3A', '22448022-9', 'ANTONIA', 'PAZ', 'LOBOS', 'CÁCERES'],
            ['3C', '22558171-1', 'MARTÍN', 'ANTONIO', 'ARELLANO', 'ACUÑA'],
            ['3C', '22897577-K', 'DAYANA', 'IGNACIA', 'AROS', 'ÁVILA'],
            ['3C', '22339310-1', 'MARÍA', 'GRACIA', 'CABRERA', 'COLOMBINO'],
            ['3C', '22865819-7', 'YARIXA', 'ALEJANDRA', 'FUENTES', 'CARRASCO'],
            ['3C', '22971225-K', 'DANIELA', 'ALEJANDRA', 'GÓMEZ', 'CANCINO'],
            ['3C', '22698950-1', 'MILLARAY', 'CAROLINA', 'GUTIÉRREZ', 'CARRIÓN'],
            ['3C', '22665539-5', 'GLORIA', 'JAVIERA', 'HONORATO', 'TAPIA'],
            ['3C', '22907525-K', 'BENJAMÍN', 'ESTEBAN', 'LARA', 'RIVERA'],
            ['3C', '22801082-0', 'JOSÉ', 'TOMÁS', 'PALACIOS', 'SOTO'],
            ['3C', '22477831-7', 'JOSÉ', 'CRISTÓBAL', 'PEZO', 'SANTANDER'],
            ['3C', '22796354-9', 'JOSÉ', 'PABLO', 'ROCHA', 'ROJAS'],
            ['3C', '22876139-7', 'FABIANA', 'ISIDORA', 'ROJAS', 'YÉVENES'],
            ['3C', '22916573-9', 'ANDY', 'ANTONIO', 'SÁNCHEZ', 'PAREJA'],
            ['3C', '22845486-9', 'SIMÓN', 'ESTEBAN', 'SANTANDER', 'LÓPEZ'],
            ['3C', '23004590-9', 'SIOMARA', 'IGNACIA', 'TRONCOSO', 'LIZAMA'],
            ['3C', '23009921-9', 'LUCIANA', 'BERNABELA', 'WARNKEN', 'ROJAS'],
            ['3C', '22783846-9', 'FRANCO', 'SEBASTIÁN', 'DE LA HOZ', 'VALENZUELA'],
            ['3C', '23048274-8', 'ANAÍS', 'VALENTINA', 'COLLAO', 'MEDINA'],
            ['4A', '22445092-3', 'HOMERO', 'ALEXANDER', 'AGURTO', 'CRESPO'],
            ['4A', '22051153-7', 'CATALINA', 'BELEN', 'ANDIA', 'DE LA HOZ'],
            ['4A', '22269531-7', 'ESTEBAN', 'ALEXANDER', 'FUENTES', 'GONZÁLEZ'],
            ['4A', '22554952-4', 'SOFÍA', 'ELENA', 'GARCÍA', 'ROJAS'],
            ['4A', '22652303-0', 'ANTONELLA', 'CONSTANZA', 'GODOY', 'HERRERA'],
            ['4A', '22312159-4', 'KEVIN', 'ALEJANDRO', 'GONZÁLEZ', 'CASTRO'],
            ['4A', '22386223-3', 'PÍA', 'IGNACIA', 'MARCHANT', 'MORÁN'],
            ['4A', '22533366-1', 'MARTÍN', 'ALAN', 'QUINTANA', 'SAN MARTÍN'],
            ['4A', '22432358-1', 'CRISTOFER', 'BASTIÁN', 'RECABAL', 'YÁÑEZ'],
            ['4A', '22293250-5', 'GABRIEL', 'ANTONIO', 'ROJAS', 'GONZÁLEZ'],
            ['4A', '22451297-K', 'ESPERANZA', 'BELÉN', 'TOLEDO', 'MUÑOZ'],
            ['4A', '22665848-3', 'FRANCISCA', 'ALEJANDRA', 'YÁÑEZ', 'GONZÁLEZ'],
        ];

        // CONSTANTES
        const SCHOOL_NAME = "Escuela Agrícola Sagrados Corazones"; 
        const LOCATION = "Villa Alegre";
        const DIRECTOR_NAME = "MIGUEL DÍAZ JARA";
        const DECREE = "Decreto Cooperador N° 17.576 del 10 de septiembre de 1965";

        const yearSelect = document.getElementById('year-select');
        const courseSelect = document.getElementById('course-select');
        const studentSelect = document.getElementById('student-select');
        const actionButtons = document.getElementById('action-buttons');
        const certificateContent = document.getElementById('certificate-content');
        const previewContainer = document.getElementById('preview-container');
        const initialPlaceholder = document.getElementById('initial-placeholder');
        
        let currentStudents = [];

        document.addEventListener('DOMContentLoaded', () => {
            yearSelect.addEventListener('change', reloadAll);
            courseSelect.addEventListener('change', loadStudents);
            studentSelect.addEventListener('change', enableButtons);
            reloadAll(); 
        });

        function getPromotedCourse(course) {
            const match = course.match(/^(\d+)(.*)$/);
            if (!match) return course; 
            const level = parseInt(match[1]);
            const letter = match[2];
            if (level >= 4) return null; 
            return (level + 1) + letter;
        }

        function getProcessedData() {
            const is2026 = yearSelect.value === "2026";
            const grouped = {};

            RAW_DATA.forEach(row => {
                let course = row[0];
                const rut = row[1];
                const name = `${row[2]} ${row[3] || ''} ${row[4]} ${row[5] || ''}`.trim().toUpperCase();

                if (is2026) {
                    course = getPromotedCourse(course);
                    if (!course) return; 
                }

                if (!grouped[course]) grouped[course] = [];
                grouped[course].push({ rut, name, course });
            });

            return grouped;
        }

        function reloadAll() {
            const data = getProcessedData();
            const courses = Object.keys(data).sort();
            
            courseSelect.innerHTML = '<option value="">Seleccionar Curso...</option>';
            courses.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.textContent = c;
                courseSelect.appendChild(opt);
            });

            studentSelect.innerHTML = '<option value="">Seleccione un curso primero</option>';
            studentSelect.disabled = true;
            actionButtons.classList.add('hidden');
            previewContainer.classList.add('hidden');
            initialPlaceholder.classList.remove('hidden');
        }

        function loadStudents() {
            const course = courseSelect.value;
            const data = getProcessedData();
            
            if (course && data[course]) {
                currentStudents = data[course].sort((a,b) => a.name.localeCompare(b.name));
                studentSelect.innerHTML = '<option value="">Seleccionar Alumno...</option>';
                currentStudents.forEach((s, index) => {
                    const opt = document.createElement('option');
                    opt.value = index; 
                    opt.textContent = s.name;
                    studentSelect.appendChild(opt);
                });
                studentSelect.disabled = false;
            } else {
                studentSelect.innerHTML = '<option value="">Seleccione un curso primero</option>';
                studentSelect.disabled = true;
            }
            actionButtons.classList.add('hidden');
        }

        function enableButtons() {
            if (studentSelect.value !== "") {
                actionButtons.classList.remove('hidden');
            } else {
                actionButtons.classList.add('hidden');
            }
        }

        function generateCertificate(type) {
            const index = studentSelect.value;
            if (index === "") return;

            const student = currentStudents[index];
            const year = yearSelect.value;
            
            const dateObj = new Date();
            const day = dateObj.getDate();
            const months = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
            const month = months[dateObj.getMonth()];
            const dateStr = `${day} de ${month} de ${dateObj.getFullYear()}`;

            let title, body;

            if (type === 'regular') {
                title = "CERTIFICADO DE ALUMNO REGULAR";
                body = `es alumno(a) regular y se encuentra matriculado en el curso <strong>${student.course}</strong>, año escolar <strong>${year}</strong>, de este establecimiento educacional.`;
            } else {
                title = "CERTIFICADO DE MATRÍCULA";
                if (year === "2026") {
                    body = `ha sido aceptado y matriculado en el curso <strong>${student.course}</strong> para el año escolar <strong>${year}</strong> en este establecimiento educacional.`;
                } else {
                    body = `se encuentra matriculado en el curso <strong>${student.course}</strong>, año escolar <strong>${year}</strong>, de este establecimiento educacional.`;
                }
            }

            // --- HTML OPTIMIZADO PARA 1 PLANA (LOGO FIJADO) ---
            const html = `
                <div class="certificate-container">
                    
                    <div class="flex justify-between items-start mb-8">
                        <div class="text-sm font-sans leading-tight text-gray-800 pt-2">
                            <p class="font-bold uppercase">Escuela Agrícola Sagrados Corazones</p>
                            <p>Corporación Educacional Veloz Educa</p>
                            <p>${LOCATION}</p>
                        </div>
                        <div>
                            <img src="logo.jpg" alt="Insignia" class="h-24 w-auto object-contain" onerror="this.style.display='none'">
                        </div>
                    </div>

                    <div class="text-center mb-8">
                        <h2 class="text-2xl font-bold uppercase underline decoration-2 underline-offset-4">${title}</h2>
                    </div>

                    <div class="text-lg leading-normal text-justify mb-6 px-4 font-serif">
                        <p class="mb-6">
                            Quien suscribe, Director de la <strong>${SCHOOL_NAME}</strong> de ${LOCATION}, ${DECREE},
                            <strong>CERTIFICA</strong>:
                        </p>
                        <p class="mb-6 indent-8">
                            Que, el alumno(a) <strong class="uppercase">${student.name}</strong>, 
                            R.U.T. <strong>${student.rut}</strong>, ${body}
                        </p>
                        <p class="indent-8">
                            Se extiende el presente certificado a petición del interesado(a), para los fines que estime conveniente.
                        </p>
                    </div>

                    <div class="text-right text-lg mb-12 px-4 font-serif">
                        ${LOCATION}, ${dateStr}.
                    </div>

                    <div class="text-center mt-12">
                        <div class="inline-block border-t border-black pt-2 px-10 font-sans">
                            <p class="font-bold text-lg uppercase">${DIRECTOR_NAME}</p>
                            <p class="text-base font-bold">DIRECTOR</p>
                            <p class="text-sm uppercase">${SCHOOL_NAME}</p>
                        </div>
                    </div>

                </div>
            `;

            certificateContent.innerHTML = html;
            initialPlaceholder.classList.add('hidden');
            previewContainer.classList.remove('hidden');
        }
    </script>
</body>
</html>